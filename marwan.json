{
  "main_code": "IyBlbmNvZGluZzogVVRGLTgKcmVxdWlyZSAnc2tldGNodXAucmInCnJlcXVpcmUgJ25ldC9odHRwJwpyZXF1aXJlICd1cmknCnJlcXVpcmUgJ2pzb24nCnJlcXVpcmUgJ3NlY3VyZXJhbmRvbScKcmVxdWlyZSAnb3Blbi11cmknCnJlcXVpcmUgJ3RtcGRpcicKcmVxdWlyZSAnYmFzZTY0JwpyZXF1aXJlICd0ZW1wZmlsZScKcmVxdWlyZSAnZGlnZXN0JwpyZXF1aXJlICdmaWxldXRpbHMnCnJlcXVpcmUgJ3psaWInCgptb2R1bGUgTUhERVNJR04KICBQTFVHSU5fTkFNRSA9ICJNSERFU0lHTiIKICAKICAjINix2YjYp9io2LcgR2l0SHViINmE2YTYqtit2YLZggogIEdJVEhVQl9BQ0NPVU5UU19VUkwgPSAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL21hcndhbmFkZWxlbHRhaGFuLXN1ZG8vQVBJMTIzL3JlZnMvaGVhZHMvbWFpbi9lbWFpbC5qc29uIgogIAogICMg2YXYs9in2LEg2YXZhNmBINin2YTYqtiu2LLZitmGINin2YTZhdit2YTZigogIEFQSV9GSUxFID0gRmlsZS5qb2luKEZpbGUuZGlybmFtZShfX0ZJTEVfXyksICJhcGkudHh0IikKICAKICBPUEVOX1RJTUVPVVQgPSA4CiAgUkVBRF9USU1FT1VUID0gMTIKCiAgIyDYrdmB2LggUExVR0lOX0RJUiDZhdiz2KfYsSBtYWluLnJiINin2YTZhdmE2YEKICBQTFVHSU5fRElSID0gRmlsZS5leHBhbmRfcGF0aChGaWxlLmRpcm5hbWUoX19GSUxFX18pKQoKICBDT01QT05FTlRTID0gYmVnaW4KICAgIHVybCA9ICJodHRwczovL21haG1vdWRkZXNpZ24uY29tL1NLRVRDSFVQL2NvbXBvbmVudHMtVjQuanNvbiIKICAgIGpzb25fcmF3ID0gVVJJLm9wZW4odXJsKS5yZWFkCiAgICBqc29uX2RhdGEgPSBKU09OLnBhcnNlKGpzb25fcmF3KQogICAgZGVjb2RlZF9qc29uID0gQmFzZTY0LmRlY29kZTY0KGpzb25fZGF0YVsiZGF0YSJdKQogICAgSlNPTi5wYXJzZShkZWNvZGVkX2pzb24sIHN5bWJvbGl6ZV9uYW1lczogdHJ1ZSkKICByZXNjdWUgPT4gZQogICAgVUkubWVzc2FnZWJveCgi4pqgINiu2LfYoyDZgdmKINiq2K3ZhdmK2YQg2KfZhNmF2YPYqtio2Kk6ICN7ZS5tZXNzYWdlfSIpCiAgICBbXQogIGVuZAoKICAjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0g2YLYsdin2KHYqS/Zg9iq2KfYqNipINio2YrYp9mG2KfYqiBBUEkg2YXZhi/YpdmE2Ykg2YXZhNmBID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICBkZWYgc2VsZi5sb2FkX2FwaV9mcm9tX2ZpbGUKICAgIHJldHVybiBuaWwgdW5sZXNzIEZpbGUuZXhpc3Q/KEFQSV9GSUxFKQogICAgCiAgICBiZWdpbgogICAgICBjb250ZW50ID0gRmlsZS5yZWFkKEFQSV9GSUxFKS5zdHJpcAogICAgICBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoIlxuIikKICAgICAgcmV0dXJuIG5pbCBpZiBsaW5lcy5lbXB0eT8KICAgICAgCiAgICAgICMg2YrZhdmD2YYg2KPZhiDZitmD2YjZhiDYp9mE2KrZhtiz2YrZgjogZW1haWw6cGFzc3dvcmQg2KPZiCDYs9i32LHZitmGINmF2YbZgdi12YTZitmGCiAgICAgIGlmIGxpbmVzWzBdLmluY2x1ZGU/KCc6JykKICAgICAgICBwYXJ0cyA9IGxpbmVzWzBdLnNwbGl0KCc6JywgMikKICAgICAgICB7IGVtYWlsOiBwYXJ0c1swXS5zdHJpcCwgcGFzc3dvcmQ6IHBhcnRzWzFdLnN0cmlwIH0KICAgICAgZWxzZQogICAgICAgIHsgZW1haWw6IGxpbmVzWzBdLnN0cmlwLCBwYXNzd29yZDogKGxpbmVzWzFdIHx8ICcnKS5zdHJpcCB9CiAgICAgIGVuZAogICAgcmVzY3VlID0+IGUKICAgICAgcHV0cyAiRXJyb3IgcmVhZGluZyBBUEkgZmlsZTogI3tlLm1lc3NhZ2V9IgogICAgICBuaWwKICAgIGVuZAogIGVuZAoKICBkZWYgc2VsZi5zYXZlX2FwaV90b19maWxlKGVtYWlsLCBwYXNzd29yZCkKICAgIGJlZ2luCiAgICAgIGNvbnRlbnQgPSAiI3tlbWFpbH06I3twYXNzd29yZH0iCiAgICAgIEZpbGUud3JpdGUoQVBJX0ZJTEUsIGNvbnRlbnQpCiAgICAgIHRydWUKICAgIHJlc2N1ZSA9PiBlCiAgICAgIHB1dHMgIkVycm9yIHNhdmluZyBBUEkgZmlsZTogI3tlLm1lc3NhZ2V9IgogICAgICBmYWxzZQogICAgZW5kCiAgZW5kCgogICMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSDYrNmE2Kgg2KfZhNit2LPYp9io2KfYqiDZhdmGIEdpdEh1YiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgZGVmIHNlbGYuZmV0Y2hfYWNjb3VudHNfZnJvbV9naXRodWIKICAgIGJlZ2luCiAgICAgIHVyaSA9IFVSSS5wYXJzZShHSVRIVUJfQUNDT1VOVFNfVVJMKQogICAgICByZXNwb25zZSA9IE5ldDo6SFRUUC5nZXRfcmVzcG9uc2UodXJpKQogICAgICAKICAgICAgaWYgcmVzcG9uc2UuY29kZS50b19pID09IDIwMAogICAgICAgIGFjY291bnRzID0gSlNPTi5wYXJzZShyZXNwb25zZS5ib2R5KQogICAgICAgIHJldHVybiBhY2NvdW50cyBpZiBhY2NvdW50cy5pc19hPyhBcnJheSkKICAgICAgZW5kCiAgICByZXNjdWUgPT4gZQogICAgICBwdXRzICJFcnJvciBmZXRjaGluZyBhY2NvdW50cyBmcm9tIEdpdEh1YjogI3tlLm1lc3NhZ2V9IgogICAgZW5kCiAgICBbXQogIGVuZAoKICBkZWYgc2VsZi52YWxpZGF0ZV93aXRoX2dpdGh1YihlbWFpbCwgcGFzc3dvcmQpCiAgICAjINis2YTYqCDYp9mE2K3Ys9in2KjYp9iqINmF2YYgR2l0SHViCiAgICBhY2NvdW50cyA9IGZldGNoX2FjY291bnRzX2Zyb21fZ2l0aHViCiAgICAKICAgICMg2KfZhNio2K3YqyDYudmGINin2YTYqNix2YrYryDZiNmD2YTZhdipINin2YTZhdix2YjYsQogICAgYWNjb3VudCA9IGFjY291bnRzLmZpbmQgZG8gfGFjY3wKICAgICAgYWNjWydlbWFpbCddLnRvX3MuZG93bmNhc2UgPT0gZW1haWwudG9fcy5kb3duY2FzZSAmJiAKICAgICAgYWNjWydwYXNzd29yZCddID09IHBhc3N3b3JkCiAgICBlbmQKICAgIAogICAgaWYgYWNjb3VudAogICAgICAjINit2YHYuCDYp9mE2KjZitin2YbYp9iqINmB2Yog2KfZhNmF2YTZgQogICAgICBzYXZlX2FwaV90b19maWxlKGVtYWlsLCBwYXNzd29yZCkKICAgICAgCiAgICAgIHJldHVybiB7CiAgICAgICAgJ3ZhbGlkJyA9PiB0cnVlLAogICAgICAgICdzdGF0dXMnID0+ICdhY3RpdmUnLAogICAgICAgICdzb3VyY2UnID0+ICdnaXRodWInCiAgICAgIH0KICAgIGVuZAogICAgCiAgICByZXR1cm4geyAndmFsaWQnID0+IGZhbHNlLCAncmVhc29uJyA9PiAnaW52YWxpZF9jcmVkZW50aWFscycgfQogIGVuZAoKICBkZWYgc2VsZi5nZXRfZGV2aWNlX2lkCiAgICBwcmVmcyA9IFNrZXRjaHVwLnJlYWRfZGVmYXVsdChQTFVHSU5fTkFNRSwgImRldmljZV9pZCIpCiAgICByZXR1cm4gcHJlZnMgdW5sZXNzIHByZWZzLm5pbD8gfHwgcHJlZnMuZW1wdHk/CiAgICBpZCA9IFNlY3VyZVJhbmRvbS51dWlkCiAgICBTa2V0Y2h1cC53cml0ZV9kZWZhdWx0KFBMVUdJTl9OQU1FLCAiZGV2aWNlX2lkIiwgaWQpCiAgICBpZAogIGVuZAoKICBkZWYgc2VsZi5odW1hbml6ZV9zZWNvbmRzKHRvdGFsKQogICAgdG90YWwgPSB0b3RhbC50b19pCiAgICBtLCBzID0gdG90YWwuZGl2bW9kKDYwKQogICAgaCwgbSA9IG0uZGl2bW9kKDYwKQogICAgcGFydHMgPSBbXQogICAgcGFydHMgPDwgIiN7aH0g2LPYp9i52KkiICAgaWYgaCA+IDAKICAgIHBhcnRzIDw8ICIje219INiv2YLZitmC2KkiICBpZiBtID4gMAogICAgcGFydHMgPDwgIiN7c30g2KvYp9mG2YrYqSIgIGlmIHMgPiAwIHx8IHBhcnRzLmVtcHR5PwogICAgcGFydHMuam9pbignINmIICcpCiAgZW5kCgogICMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSDYqtmB2LnZitmEINin2YTYpdi22KfZgdipID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgZGVmIHNlbGYuYWN0aXZhdGUoZm9yY2VfcHJvbXB0ID0gdHJ1ZSkKICAgICMg2KPZiNmE2KfZizog2YXYrdin2YjZhNipINin2YTYqtmB2LnZitmEINin2YTYqtmE2YLYp9im2Yog2YXZhiDYp9mE2YXZhNmBCiAgICBhcGlfZGF0YSA9IGxvYWRfYXBpX2Zyb21fZmlsZQogICAgaWYgYXBpX2RhdGEgJiYgIWZvcmNlX3Byb21wdAogICAgICBlbWFpbCA9IGFwaV9kYXRhWzplbWFpbF0KICAgICAgcGFzc3dvcmQgPSBhcGlfZGF0YVs6cGFzc3dvcmRdCiAgICAgIAogICAgICBpZiAhZW1haWwuZW1wdHk/ICYmICFwYXNzd29yZC5lbXB0eT8KICAgICAgICAjINin2YTYqtit2YLZgiDZhdmGINi12K3YqSDYp9mE2KjZitin2YbYp9iqINmF2LkgR2l0SHViCiAgICAgICAgcmVzdWx0ID0gdmFsaWRhdGVfd2l0aF9naXRodWIoZW1haWwsIHBhc3N3b3JkKQogICAgICAgIAogICAgICAgIGlmIHJlc3VsdFsndmFsaWQnXQogICAgICAgICAgIyDYrdmB2Lgg2KfZhNio2YrYp9mG2KfYqiDZgdmKINil2LnYr9in2K/Yp9iqIFNrZXRjaHVwCiAgICAgICAgICBTa2V0Y2h1cC53cml0ZV9kZWZhdWx0KFBMVUdJTl9OQU1FLCAiZW1haWwiLCBlbWFpbCkKICAgICAgICAgIFNrZXRjaHVwLndyaXRlX2RlZmF1bHQoUExVR0lOX05BTUUsICJsaWNlbnNlIiwgcGFzc3dvcmQpCiAgICAgICAgICBTa2V0Y2h1cC53cml0ZV9kZWZhdWx0KFBMVUdJTl9OQU1FLCAiYWN0aXZhdGVkX29uY2UiLCB0cnVlKQogICAgICAgICAgU2tldGNodXAud3JpdGVfZGVmYXVsdChQTFVHSU5fTkFNRSwgImdpdGh1Yl9hY3RpdmF0ZWQiLCB0cnVlKQogICAgICAgICAgCiAgICAgICAgICBwdXRzICLinIUg2KrZhSDYp9mE2KrZgdi52YrZhCDYp9mE2KrZhNmC2KfYptmKINmF2YYg2KfZhNmF2YTZgSIKICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgZW5kCiAgICAgIGVuZAogICAgZW5kCiAgICAKICAgICMg2KXYsNinINmB2LTZhCDYp9mE2KrZgdi52YrZhCDYp9mE2KrZhNmC2KfYptmK2Iwg2LfZhNioINin2YTYqNmK2KfZhtin2Kog2YXZhiDYp9mE2YXYs9iq2K7Yr9mFCiAgICBlbWFpbCA9IFNrZXRjaHVwLnJlYWRfZGVmYXVsdChQTFVHSU5fTkFNRSwgImVtYWlsIikgfHwgIiIKICAgIHBhc3N3b3JkID0gU2tldGNodXAucmVhZF9kZWZhdWx0KFBMVUdJTl9OQU1FLCAibGljZW5zZSIpIHx8ICIiCgogICAgaWYgZm9yY2VfcHJvbXB0IHx8IGVtYWlsLmVtcHR5PyB8fCBwYXNzd29yZC5lbXB0eT8KICAgICAgaW5wdXQgPSBVSS5pbnB1dGJveChbItij2K/YrtmEINin2YTYqNix2YrYryDYp9mE2KXZhNmD2KrYsdmI2YbZiiIsICLYo9iv2K7ZhCDZhdmB2KrYp9itINin2YTYqtix2K7Ziti1Il0sIFtlbWFpbCwgcGFzc3dvcmRdLCAi2KrZgdi52YrZhCBNSERFU0lHTiIpCiAgICAgIHJldHVybiBmYWxzZSB1bmxlc3MgaW5wdXQKICAgICAgZW1haWwsIHBhc3N3b3JkID0gaW5wdXQKICAgIGVuZAoKICAgICMg2KfZhNiq2K3ZgtmCINmF2YYgR2l0SHViCiAgICBnaXRodWJfcmVzdWx0ID0gdmFsaWRhdGVfd2l0aF9naXRodWIoZW1haWwsIHBhc3N3b3JkKQogICAgCiAgICBpZiBnaXRodWJfcmVzdWx0Wyd2YWxpZCddCiAgICAgICMg2K3Zgdi4INin2YTYqNmK2KfZhtin2Kog2YHZiiDYpdi52K/Yp9iv2KfYqiBTa2V0Y2h1cAogICAgICBTa2V0Y2h1cC53cml0ZV9kZWZhdWx0KFBMVUdJTl9OQU1FLCAiZW1haWwiLCBlbWFpbCkKICAgICAgU2tldGNodXAud3JpdGVfZGVmYXVsdChQTFVHSU5fTkFNRSwgImxpY2Vuc2UiLCBwYXNzd29yZCkKICAgICAgU2tldGNodXAud3JpdGVfZGVmYXVsdChQTFVHSU5fTkFNRSwgImFjdGl2YXRlZF9vbmNlIiwgdHJ1ZSkKICAgICAgU2tldGNodXAud3JpdGVfZGVmYXVsdChQTFVHSU5fTkFNRSwgImdpdGh1Yl9hY3RpdmF0ZWQiLCB0cnVlKQogICAgICAKICAgICAgIyDYrdmB2Lgg2KfZhNio2YrYp9mG2KfYqiDZgdmKINin2YTZhdmE2YEKICAgICAgc2F2ZV9hcGlfdG9fZmlsZShlbWFpbCwgcGFzc3dvcmQpCiAgICAgIAogICAgICBVSS5tZXNzYWdlYm94KCLinIUg2KrZhSDYp9mE2KrZgdi52YrZhCDYqNmG2KzYp9itIikgaWYgZm9yY2VfcHJvbXB0CiAgICAgIHJldHVybiB0cnVlCiAgICBlbmQKCiAgICAjINil2LDYpyDZgdi02YQg2KfZhNiq2K3ZgtmCINmF2YYgR2l0SHVi2Iwg2KzYsdioINin2YTYt9ix2YrZgtipINin2YTYo9i12YTZitipCiAgICBiZWdpbgogICAgICBkZXZpY2UgPSBnZXRfZGV2aWNlX2lkCiAgICAgIHVyaSAgICA9IFVSSS5wYXJzZSgiaHR0cHM6Ly9tYWhtb3VkZGVzaWduLmNvbS93cC1qc29uL21oZGVzaWduL1Y0L3ZhbGlkYXRlIikKCiAgICAgIGh0dHAgPSBOZXQ6OkhUVFAubmV3KHVyaS5ob3N0LCB1cmkucG9ydCkKICAgICAgaHR0cC51c2Vfc3NsICAgICA9ICh1cmkuc2NoZW1lID09ICdodHRwcycpCiAgICAgIGh0dHAub3Blbl90aW1lb3V0ID0gT1BFTl9USU1FT1VUCiAgICAgIGh0dHAucmVhZF90aW1lb3V0ID0gUkVBRF9USU1FT1VUCgogICAgICByZXEgPSBOZXQ6OkhUVFA6OlBvc3QubmV3KHVyaS5yZXF1ZXN0X3VyaSkKICAgICAgcmVxWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi9qc29uJwogICAgICByZXFbJ1VzZXItQWdlbnQnXSAgICA9ICJTa2V0Y2hVcC8je1NrZXRjaHVwLnZlcnNpb259IFJ1YnkvI3tSVUJZX1ZFUlNJT059ICN7UExVR0lOX05BTUV9IgogICAgICByZXEuYm9keSA9IHsgZW1haWw6IGVtYWlsLCBsaWNlbnNlOiBwYXNzd29yZCwgZGV2aWNlX2lkOiBkZXZpY2UgfS50b19qc29uCgogICAgICByZXMgID0gaHR0cC5yZXF1ZXN0KHJlcSkKICAgICAgY29kZSA9IHJlcy5jb2RlLnRvX2kKICAgICAgZGF0YSA9IEpTT04ucGFyc2UocmVzLmJvZHkpIHJlc2N1ZSB7fQoKICAgICAgaWYgY29kZSA9PSAyMDAgJiYgZGF0YVsndmFsaWQnXQogICAgICAgIFNrZXRjaHVwLndyaXRlX2RlZmF1bHQoUExVR0lOX05BTUUsICJlbWFpbCIsIGVtYWlsKQogICAgICAgIFNrZXRjaHVwLndyaXRlX2RlZmF1bHQoUExVR0lOX05BTUUsICJsaWNlbnNlIiwgcGFzc3dvcmQpCiAgICAgICAgU2tldGNodXAud3JpdGVfZGVmYXVsdChQTFVHSU5fTkFNRSwgImFjdGl2YXRlZF9vbmNlIiwgdHJ1ZSkKCiAgICAgICAgaWYgZGF0YS5rZXk/KCdlbmRzX2F0JykgJiYgIWRhdGFbJ2VuZHNfYXQnXS50b19zLnN0cmlwLmVtcHR5PwogICAgICAgICAgU2tldGNodXAud3JpdGVfZGVmYXVsdChQTFVHSU5fTkFNRSwgImVuZHNfYXQiLCBkYXRhWydlbmRzX2F0J10udG9fcykKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAjINit2YHYuCDYp9mE2KjZitin2YbYp9iqINmB2Yog2KfZhNmF2YTZgQogICAgICAgIHNhdmVfYXBpX3RvX2ZpbGUoZW1haWwsIHBhc3N3b3JkKQoKICAgICAgICBVSS5tZXNzYWdlYm94KCLinIUg2KrZhSDYp9mE2KrZgdi52YrZhCDYqNmG2KzYp9itIikgaWYgZm9yY2VfcHJvbXB0CiAgICAgICAgcmV0dXJuIHRydWUKICAgICAgZW5kCgogICAgICBpZiBjb2RlID09IDQyOSB8fCBkYXRhWydyZWFzb24nXSA9PSAncmF0ZV9saW1pdGVkJwogICAgICAgIHJldHJ5X2FmdGVyID0gKHJlc1snUmV0cnktQWZ0ZXInXSB8fCBkYXRhWydyZXRyeV9hZnRlciddKS50b19pCiAgICAgICAgbXNnID0gcmV0cnlfYWZ0ZXIgPiAwID8gItiq2YUg2KrYrNin2YjYsiDYp9mE2K3YryDYp9mE2YXYs9mF2YjYrdiMINmK2LHYrNmJINin2YTZhdit2KfZiNmE2Kkg2KjYudivICN7aHVtYW5pemVfc2Vjb25kcyhyZXRyeV9hZnRlcil9LiIgOiAi2KrZhSDYqtis2KfZiNiyINin2YTYrdivINin2YTZhdiz2YXZiNitLi4uIgogICAgICAgIFVJLm1lc3NhZ2Vib3gobXNnKSBpZiBmb3JjZV9wcm9tcHQKICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgZW5kCgogICAgICByZWFzb24gPSAoZGF0YVsncmVhc29uJ10gfHwgJ2RlbmllZCcpLnRvX3MKICAgICAgbXNnID0KICAgICAgICBjYXNlIHJlYXNvbgogICAgICAgIHdoZW4gJ25vdF9zdGFydGVkJyB0aGVuICLYp9mE2KrYsdiu2YrYtSDZhNmFINmK2KjYr9ijINio2LnYry5cbiN7ZGF0YVsnc3RhcnRzX2F0J119IgogICAgICAgIHdoZW4gJ2V4cGlyZWQnICAgICB0aGVuICLYp9mG2KrZh9iqINi12YTYp9it2YrYqSDYp9mE2KrYsdiu2YrYtTpcbiN7ZGF0YVsnZW5kc19hdCddfVxu2YrYsdis2Ykg2KrYrNiv2YrYryDYp9mE2KfYtNiq2LHYp9mDLiIKICAgICAgICB3aGVuICdtaXNtYXRjaCcgICAgdGhlbiAi2KfZhNio2YrYp9mG2KfYqiDYutmK2LEg2YXYqti32KfYqNmC2KkgKNio2LHZitivL9mF2YHYqtin2K0v2KzZh9in2LIpLiIKICAgICAgICB3aGVuICdkaXNhYmxlZCcgICAgdGhlbiAi2KfZhNiq2LHYrtmK2LUg2YXYudi32YQg2YXZhiDZgtio2YQg2KfZhNmF2LTYsdmBLiIKICAgICAgICB3aGVuICdub3RfZm91bmQnICAgdGhlbiAi2YTZhSDZitiq2YUg2KfZhNi52KvZiNixINi52YTZiSDYp9mE2KrYsdiu2YrYtS4iCiAgICAgICAgZWxzZSAgICAgICAgICAgICAgICAgICAgICLimqAg2K3Yr9irINiu2LfYoyDYo9ir2YbYp9ihINin2YTYqtit2YLZgiAtICN7ZGF0YVsncmVhc29uJ10gfHwgcmVhc29ufSIKICAgICAgICBlbmQKICAgICAgVUkubWVzc2FnZWJveChtc2cpIGlmIGZvcmNlX3Byb21wdAogICAgICBmYWxzZQoKICAgIHJlc2N1ZSA9PiBlCiAgICAgIGlmIFNrZXRjaHVwLnJlYWRfZGVmYXVsdChQTFVHSU5fTkFNRSwgImFjdGl2YXRlZF9vbmNlIikKICAgICAgICB0cnVlCiAgICAgIGVsc2UKICAgICAgICBVSS5tZXNzYWdlYm94KCLinYwg2K3Yr9irINiu2LfYoyDYo9ir2YbYp9ihINin2YTYqtmB2LnZitmEOiAje2UubWVzc2FnZX0iKSBpZiBmb3JjZV9wcm9tcHQKICAgICAgICBmYWxzZQogICAgICBlbmQKICAgIGVuZAogIGVuZAoKICAjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0g2YXYudmE2YjZhdin2Kog2KfZhNmF2LPYqtiu2K/ZhSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgZGVmIHNlbGYuc2hvd191c2VyX2luZm8KICAgIGVtYWlsICAgPSBTa2V0Y2h1cC5yZWFkX2RlZmF1bHQoUExVR0lOX05BTUUsICJlbWFpbCIpLnRvX3MKICAgIHBhc3N3b3JkID0gU2tldGNodXAucmVhZF9kZWZhdWx0KFBMVUdJTl9OQU1FLCAibGljZW5zZSIpLnRvX3MKICAgIGVuZHNfYXQgPSBTa2V0Y2h1cC5yZWFkX2RlZmF1bHQoUExVR0lOX05BTUUsICJlbmRzX2F0IikudG9fcwogICAgZ2l0aHViX2FjdGl2YXRlZCA9IFNrZXRjaHVwLnJlYWRfZGVmYXVsdChQTFVHSU5fTkFNRSwgImdpdGh1Yl9hY3RpdmF0ZWQiKQoKICAgIGlmIGVtYWlsLmVtcHR5PyB8fCBwYXNzd29yZC5lbXB0eT8KICAgICAgIyDZhdit2KfZiNmE2Kkg2KfZhNmC2LHYp9ih2Kkg2YXZhiDYp9mE2YXZhNmBCiAgICAgIGFwaV9kYXRhID0gbG9hZF9hcGlfZnJvbV9maWxlCiAgICAgIGlmIGFwaV9kYXRhCiAgICAgICAgZW1haWwgPSBhcGlfZGF0YVs6ZW1haWxdCiAgICAgICAgcGFzc3dvcmQgPSBhcGlfZGF0YVs6cGFzc3dvcmRdCiAgICAgIGVuZAogICAgZW5kCgogICAgaWYgZW1haWwuZW1wdHk/IHx8IHBhc3N3b3JkLmVtcHR5PwogICAgICBVSS5tZXNzYWdlYm94KCLinYwg2YTZhSDZitiq2YUg2KrZgdi52YrZhCDYp9mE2YXZg9iq2KjYqSDYqNi52K8uXG7Yp9mG2KrZgtmEINil2YTZiTogUGx1Z2lucyA+IE1IREVTSUdOIC0g2KrZgdi52YrZhCIpCiAgICAgIHJldHVybgogICAgZW5kCgogICAgZW5kc190eHQgPSBlbmRzX2F0LnN0cmlwLmVtcHR5PyA/ICLYqtmB2LnZitmEINiv2KfYptmFIiA6IGVuZHNfYXQKICAgIHNvdXJjZSA9IGdpdGh1Yl9hY3RpdmF0ZWQgPyAiR2l0SHViIiA6ICLYp9mE2LPZitix2YHYsSDYp9mE2KPYtdmE2YoiCgogICAgVUkubWVzc2FnZWJveCgKICAgICAgIvCfkaQg2YXYudmE2YjZhdin2Kog2KfZhNmF2LTYqtix2YMgKE1IREVTSUdOKVxuXG4iIFwKICAgICAgIvCfk6cg2KfZhNio2LHZitivINin2YTYpdmE2YPYqtix2YjZhtmKOlxuI3tlbWFpbH1cblxuIiBcCiAgICAgICLwn5SRINmF2YHYqtin2K0g2KfZhNiq2LHYrtmK2LU6XG4je3Bhc3N3b3JkfVxuXG4iIFwKICAgICAgIuKPsyDZitmG2KrZh9mKINin2YTYqtmB2LnZitmEOlxuI3tlbmRzX3R4dH1cblxuIiBcCiAgICAgICLwn4yQINmF2LXYr9ixINin2YTYqtmB2LnZitmEOlxuI3tzb3VyY2V9XG5cbiIgXAogICAgICAi8J+SviDYqNmK2KfZhtin2Kog2YXYrtiy2YbYqSDZgdmKINmF2YTZgTogI3tGaWxlLmV4aXN0PyhBUElfRklMRSkgPyAn2YbYudmFJyA6ICfZhNinJ30iCiAgICApCiAgZW5kCgogICMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSDYp9mE2KrYrdmC2YIg2KfZhNiq2YTZgtin2KbZiiDYudmG2K8g2KrYtNi62YrZhCDYp9mE2KXYttin2YHYqSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgZGVmIHNlbGYuYXV0b19hY3RpdmF0ZQogICAgIyDYp9mE2KrYrdmC2YIg2KXYsNinINmD2KfZhiDZhdmB2LnZhNin2Ysg2YXYs9io2YLYp9mLCiAgICBpZiBTa2V0Y2h1cC5yZWFkX2RlZmF1bHQoUExVR0lOX05BTUUsICJhY3RpdmF0ZWRfb25jZSIpCiAgICAgIHJldHVybiB0cnVlCiAgICBlbmQKICAgIAogICAgIyDZhdit2KfZiNmE2Kkg2KfZhNiq2YHYudmK2YQg2KfZhNiq2YTZgtin2KbZiiDZhdmGINin2YTZhdmE2YEKICAgIGFwaV9kYXRhID0gbG9hZF9hcGlfZnJvbV9maWxlCiAgICBpZiBhcGlfZGF0YQogICAgICBlbWFpbCA9IGFwaV9kYXRhWzplbWFpbF0KICAgICAgcGFzc3dvcmQgPSBhcGlfZGF0YVs6cGFzc3dvcmRdCiAgICAgIAogICAgICBpZiAhZW1haWwuZW1wdHk/ICYmICFwYXNzd29yZC5lbXB0eT8KICAgICAgICAjINin2YTYqtit2YLZgiDZhdmGINi12K3YqSDYp9mE2KjZitin2YbYp9iqINmF2LkgR2l0SHViCiAgICAgICAgcmVzdWx0ID0gdmFsaWRhdGVfd2l0aF9naXRodWIoZW1haWwsIHBhc3N3b3JkKQogICAgICAgIAogICAgICAgIGlmIHJlc3VsdFsndmFsaWQnXQogICAgICAgICAgU2tldGNodXAud3JpdGVfZGVmYXVsdChQTFVHSU5fTkFNRSwgImVtYWlsIiwgZW1haWwpCiAgICAgICAgICBTa2V0Y2h1cC53cml0ZV9kZWZhdWx0KFBMVUdJTl9OQU1FLCAibGljZW5zZSIsIHBhc3N3b3JkKQogICAgICAgICAgU2tldGNodXAud3JpdGVfZGVmYXVsdChQTFVHSU5fTkFNRSwgImFjdGl2YXRlZF9vbmNlIiwgdHJ1ZSkKICAgICAgICAgIFNrZXRjaHVwLndyaXRlX2RlZmF1bHQoUExVR0lOX05BTUUsICJnaXRodWJfYWN0aXZhdGVkIiwgdHJ1ZSkKICAgICAgICAgIAogICAgICAgICAgcHV0cyAi4pyFINiq2YUg2KfZhNiq2YHYudmK2YQg2KfZhNiq2YTZgtin2KbZiiDYqNmG2KzYp9itIgogICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgZmFsc2UKICBlbmQKCiAgIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09INmF2LPYrSDYp9mE2KrYrtiy2YrZhiDYp9mE2YXYpNmC2KogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIGRlZiBzZWxmLmNsZWFyX2NhY2hlCiAgICBjYWNoZV9kaXIgPSBGaWxlLmpvaW4oRGlyLnRtcGRpciwgIm1oZGVzaWduX2NhY2hlXzEiKQogICAgRmlsZVV0aWxzLnJtX3JmKGNhY2hlX2RpcikgaWYgRmlsZS5kaXJlY3Rvcnk/KGNhY2hlX2RpcikKICAgIFVJLm1lc3NhZ2Vib3goIuKchSDYqtmFINmF2LPYrSDYsNin2YPYsdipINin2YTYqtiu2LLZitmGINin2YTZhdik2YLYqi4iKQogIHJlc2N1ZSA9PiBlCiAgICBVSS5tZXNzYWdlYm94KCLimqAg2K3Yr9irINiu2LfYoyDYo9ir2YbYp9ihINmF2LPYrSDYp9mE2KrYrtiy2YrZhiDYp9mE2YXYpNmC2Ko6ICN7ZS5tZXNzYWdlfSIpCiAgZW5kCgogICMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSDYr9mK2YbYp9mF2YrZgyDZg9mI2YXYqNmI2YbZhtiqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICBkZWYgc2VsZi5keW5hbWljPyhpbnN0YW5jZSkKICAgIHJldHVybiBmYWxzZSB1bmxlc3MgaW5zdGFuY2UuaXNfYT8oU2tldGNodXA6OkNvbXBvbmVudEluc3RhbmNlKQogICAgISFpbnN0YW5jZS5hdHRyaWJ1dGVfZGljdGlvbmFyeSgiZHluYW1pY19hdHRyaWJ1dGVzIiwgZmFsc2UpCiAgcmVzY3VlCiAgICBmYWxzZQogIGVuZAoKICBkZWYgc2VsZi51bndyYXBfdG9fZHluYW1pYyEoaW5zdGFuY2UpCiAgICByZXR1cm4gaW5zdGFuY2UgaWYgZHluYW1pYz8oaW5zdGFuY2UpCgogICAgZW50cyA9IGluc3RhbmNlLmRlZmluaXRpb24uZW50aXRpZXMudG9fYQogICAgY2hpbGRyZW4gPSBlbnRzLmdyZXAoU2tldGNodXA6OkNvbXBvbmVudEluc3RhbmNlKQogICAgZHluX2NoaWxkcmVuID0gY2hpbGRyZW4uc2VsZWN0IHt8Y3wgZHluYW1pYz8oYykgfQogICAgcmV0dXJuIGluc3RhbmNlIGlmIGR5bl9jaGlsZHJlbi5lbXB0eT8KCiAgICBtb2RlbCA9IFNrZXRjaHVwLmFjdGl2ZV9tb2RlbAogICAgbW9kZWwuc3RhcnRfb3BlcmF0aW9uKCJVbndyYXAgRHluYW1pYyBDb21wb25lbnQiLCB0cnVlKQogICAgYmVnaW4KICAgICAgcGFyZW50X2VudHMgPSBpbnN0YW5jZS5wYXJlbnQuZW50aXRpZXMKICAgICAgYmVmb3JlX2lkcyA9IHBhcmVudF9lbnRzLnRvX2EubWFwKCY6ZW50aXR5SUQpCgogICAgICBpbnN0YW5jZS5leHBsb2RlCgogICAgICBhZnRlciA9IHBhcmVudF9lbnRzLnRvX2EucmVqZWN0IHsgfGV8IGJlZm9yZV9pZHMuaW5jbHVkZT8oZS5lbnRpdHlJRCkgfQogICAgICBhZnRlcl9pbnN0cyA9IGFmdGVyLmdyZXAoU2tldGNodXA6OkNvbXBvbmVudEluc3RhbmNlKQoKICAgICAgZHluID0gYWZ0ZXJfaW5zdHMuZmluZCB7IHx4fCBkeW5hbWljPyh4KSB9IHx8IGFmdGVyX2luc3RzLmZpcnN0CiAgICAgIG1vZGVsLnNlbGVjdGlvbi5jbGVhcgogICAgICBtb2RlbC5zZWxlY3Rpb24uYWRkKGR5bikgaWYgZHluCiAgICAgIG1vZGVsLmNvbW1pdF9vcGVyYXRpb24KICAgICAgZHluIHx8IGluc3RhbmNlCiAgICByZXNjdWUKICAgICAgbW9kZWwuYWJvcnRfb3BlcmF0aW9uIHJlc2N1ZSBuaWwKICAgICAgaW5zdGFuY2UKICAgIGVuZAogIGVuZAoKICBjbGFzcyBQbGFjZUFuZFVud3JhcE9ic2VydmVyIDwgU2tldGNodXA6OkVudGl0aWVzT2JzZXJ2ZXIKICAgIGRlZiBpbml0aWFsaXplKHRhcmdldF9kZWYpCiAgICAgIEB0YXJnZXRfZGVmID0gdGFyZ2V0X2RlZgogICAgICBAZG9uZSA9IGZhbHNlCiAgICBlbmQKCiAgICBkZWYgb25FbGVtZW50QWRkZWQoZW50aXRpZXMsIGVudGl0eSkKICAgICAgcmV0dXJuIGlmIEBkb25lCiAgICAgIHJldHVybiB1bmxlc3MgZW50aXR5LmlzX2E/KFNrZXRjaHVwOjpDb21wb25lbnRJbnN0YW5jZSkKICAgICAgcmV0dXJuIHVubGVzcyBlbnRpdHkuZGVmaW5pdGlvbiA9PSBAdGFyZ2V0X2RlZgoKICAgICAgQGRvbmUgPSB0cnVlCiAgICAgIG1vZGVsID0gU2tldGNodXAuYWN0aXZlX21vZGVsCgogICAgICBVSS5zdGFydF90aW1lcigwLjAsIGZhbHNlKSBkbwogICAgICAgIGJlZ2luCiAgICAgICAgICBpbnN0MiA9IE1IREVTSUdOLnVud3JhcF90b19keW5hbWljIShlbnRpdHkpCiAgICAgICAgICBtb2RlbC5zZWxlY3Rpb24uY2xlYXIKICAgICAgICAgIG1vZGVsLnNlbGVjdGlvbi5hZGQoaW5zdDIpIGlmIGluc3QyCiAgICAgICAgcmVzY3VlCiAgICAgICAgZW5zdXJlCiAgICAgICAgICBiZWdpbgogICAgICAgICAgICBlbnRpdGllcy5yZW1vdmVfb2JzZXJ2ZXIoc2VsZikKICAgICAgICAgIHJlc2N1ZQogICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgIGVuZAogICAgZW5kCiAgZW5kCgogIGRlZiBzZWxmLmluc3RhbGxfcGxhY2Vfb2JzZXJ2ZXJfZm9yKGRlZmluaXRpb24pCiAgICBlbnRzID0gU2tldGNodXAuYWN0aXZlX21vZGVsLmVudGl0aWVzCiAgICBvYnMgPSBQbGFjZUFuZFVud3JhcE9ic2VydmVyLm5ldyhkZWZpbml0aW9uKQogICAgZW50cy5hZGRfb2JzZXJ2ZXIob2JzKQoKICAgIFVJLnN0YXJ0X3RpbWVyKDIwLjAsIGZhbHNlKSBkbwogICAgICBiZWdpbgogICAgICAgIGVudHMucmVtb3ZlX29ic2VydmVyKG9icykKICAgICAgcmVzY3VlCiAgICAgIGVuZAogICAgZW5kCiAgZW5kCgogICMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSDYqtit2YXZitmEINin2YTZg9mI2YXYqNmI2YbZhtiqINmF2Lkg2KfZhNiq2YLYr9mFID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICBkZWYgc2VsZi5mZXRjaF9kZWZpbml0aW9uX2FzeW5jKGNvbXAsICZibG9jaykKICAgIGJlZ2luCiAgICAgIHVybCA9IFVSSS5wYXJzZShjb21wWzp1cmxdLnRvX3MpCiAgICAgIGNhY2hlX2RpciA9IEZpbGUuam9pbihEaXIudG1wZGlyLCAibWhkZXNpZ25fY2FjaGVfMSIpCiAgICAgIEZpbGVVdGlscy5ta2Rpcl9wKGNhY2hlX2RpcikKCiAgICAgIGhhc2hfbmFtZSAgPSBEaWdlc3Q6OlNIQTI1Ni5oZXhkaWdlc3QodXJsLnRvX3MpWzAuLjE2XSArICIuc2twIgogICAgICBsb2NhbF9wYXRoID0gRmlsZS5qb2luKGNhY2hlX2RpciwgaGFzaF9uYW1lKQogICAgICBtb2RlbCAgICAgID0gU2tldGNodXAuYWN0aXZlX21vZGVsCgogICAgICBpZiBGaWxlLmV4aXN0Pyhsb2NhbF9wYXRoKSAmJiBGaWxlLnNpemUobG9jYWxfcGF0aCkgPiAwCiAgICAgICAgZGVmaW5pdGlvbiA9IG1vZGVsLmRlZmluaXRpb25zLmxvYWQobG9jYWxfcGF0aCwgYWxsb3dfbmV3ZXI6IHRydWUpCiAgICAgICAgYmxvY2suY2FsbChkZWZpbml0aW9uKSBpZiBibG9jawogICAgICAgIHJldHVybgogICAgICBlbmQKCiAgICAgIHByb2dyZXNzID0gVUk6Okh0bWxEaWFsb2cubmV3KHsKICAgICAgICA6ZGlhbG9nX3RpdGxlID0+ICLYrNin2LEg2KfZhNiq2K3ZhdmK2YQuLi4iLAogICAgICAgIDpwcmVmZXJlbmNlc19rZXkgPT4gIm1oZGVzaWduX3Byb2dyZXNzIiwKICAgICAgICA6c2Nyb2xsYWJsZSA9PiBmYWxzZSwKICAgICAgICA6cmVzaXphYmxlID0+IGZhbHNlLAogICAgICAgIDp3aWR0aCA9PiAzMDAsCiAgICAgICAgOmhlaWdodCA9PiAxNTAKICAgICAgfSkKCiAgICAgIHByb2dyZXNzLnNldF9odG1sIDw8LUhUTUwKICAgICAgICA8aHRtbD48aGVhZD4KICAgICAgICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KICAgICAgICAgIDxsaW5rIGhyZWY9Imh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9VGFqYXdhbDp3Z2h0QDQwMDs3MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPgogICAgICAgICAgPHN0eWxlPgogICAgICAgICAgICBib2R5IHsgZm9udC1mYW1pbHk6J1RhamF3YWwnLHNhbnMtc2VyaWY7IHRleHQtYWxpZ246Y2VudGVyOyBtYXJnaW46MDsgcGFkZGluZzoyMHB4OyBkaXJlY3Rpb246cnRsOyB9CiAgICAgICAgICAgIGgzIHsgbWFyZ2luOiAxMHB4IDA7IH0KICAgICAgICAgICAgI3Byb2dyZXNzLWJhciB7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDIwcHg7IGJhY2tncm91bmQ6ICNkZGQ7IGJvcmRlci1yYWRpdXM6IDEwcHg7IG92ZXJmbG93OiBoaWRkZW47IG1hcmdpbi10b3A6IDEwcHg7IH0KICAgICAgICAgICAgI3Byb2dyZXNzLWZpbGwgeyBoZWlnaHQ6IDEwMCU7IHdpZHRoOiAwJTsgYmFja2dyb3VuZDogIzRjYWY1MDsgdHJhbnNpdGlvbjogd2lkdGggMC4ycyBlYXNlOyB9CiAgICAgICAgICAgICNwZXJjZW50IHsgbWFyZ2luLXRvcDogOHB4OyBmb250LXNpemU6IDE0cHg7IH0KICAgICAgICAgIDwvc3R5bGU+CiAgICAgICAgPC9oZWFkPjxib2R5PgogICAgICAgICAgPGgzPtis2KfYsSDYqtit2YXZitmEINin2YTYudmG2LXYsS4uLjwvaDM+CiAgICAgICAgICA8ZGl2IGlkPSJwcm9ncmVzcy1iYXIiPjxkaXYgaWQ9InByb2dyZXNzLWZpbGwiPjwvZGl2PjwvZGl2PgogICAgICAgICAgPGRpdiBpZD0icGVyY2VudCI+MCU8L2Rpdj4KICAgICAgICA8L2JvZHk+PC9odG1sPgogICAgICBIVE1MCgogICAgICBwcm9ncmVzcy5zaG93CgogICAgICBVSS5zdGFydF90aW1lcigwLjEsIGZhbHNlKSBkbwogICAgICAgIHRlbXBmaWxlID0gbmlsCiAgICAgICAgYmVnaW4KICAgICAgICAgIGNvbnRlbnRfbGVuZ3RoID0gbmlsCiAgICAgICAgICB0ZW1wZmlsZSA9IFRlbXBmaWxlLm5ldygibWhjb21wb25lbnQiKQoKICAgICAgICAgIFVSSS5vcGVuKHVybCwKICAgICAgICAgICAgY29udGVudF9sZW5ndGhfcHJvYzogLT4obGVuKSB7IGNvbnRlbnRfbGVuZ3RoID0gbGVuIH0sCiAgICAgICAgICAgIHByb2dyZXNzX3Byb2M6IC0+KGJ5dGVzKSB7CiAgICAgICAgICAgICAgcGVyY2VudCA9IGNvbnRlbnRfbGVuZ3RoID8gKChieXRlcy50b19mIC8gY29udGVudF9sZW5ndGgpICogMTAwKS50b19pIDogMAogICAgICAgICAgICAgIHByb2dyZXNzLmV4ZWN1dGVfc2NyaXB0KCJkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3MtZmlsbCcpLnN0eWxlLndpZHRoID0gJyN7cGVyY2VudH0lJyIpCiAgICAgICAgICAgICAgcHJvZ3Jlc3MuZXhlY3V0ZV9zY3JpcHQoImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZXJjZW50JykuaW5uZXJUZXh0ID0gJyN7cGVyY2VudH0lJyIpCiAgICAgICAgICAgIH0KICAgICAgICAgICkgZG8gfHJlbW90ZV9maWxlfAogICAgICAgICAgICBJTy5jb3B5X3N0cmVhbShyZW1vdGVfZmlsZSwgdGVtcGZpbGUpCiAgICAgICAgICBlbmQKCiAgICAgICAgICB0ZW1wZmlsZS5jbG9zZQogICAgICAgICAgRmlsZVV0aWxzLm12KHRlbXBmaWxlLnBhdGgsIGxvY2FsX3BhdGgpCiAgICAgICAgICBwcm9ncmVzcy5jbG9zZSBpZiBwcm9ncmVzcy52aXNpYmxlPwoKICAgICAgICAgIGlmIEZpbGUuZXhpc3Q/KGxvY2FsX3BhdGgpICYmIEZpbGUuc2l6ZShsb2NhbF9wYXRoKSA+IDAKICAgICAgICAgICAgZGVmaW5pdGlvbiA9IG1vZGVsLmRlZmluaXRpb25zLmxvYWQobG9jYWxfcGF0aCwgYWxsb3dfbmV3ZXI6IHRydWUpCiAgICAgICAgICAgIGJsb2NrLmNhbGwoZGVmaW5pdGlvbikgaWYgYmxvY2sKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgVUkubWVzc2FnZWJveCgi4p2MINmB2LTZhCDYqtit2YXZitmEINin2YTZhdmE2YEg2YXZhiDYp9mE2LPZitix2YHYsS4iKQogICAgICAgICAgICBibG9jay5jYWxsKG5pbCkgaWYgYmxvY2sKICAgICAgICAgIGVuZAoKICAgICAgICByZXNjdWUgPT4gZQogICAgICAgICAgYmVnaW4KICAgICAgICAgICAgdGVtcGZpbGUuY2xvc2UgaWYgdGVtcGZpbGUKICAgICAgICAgICAgdGVtcGZpbGUudW5saW5rIGlmIHRlbXBmaWxlCiAgICAgICAgICByZXNjdWUKICAgICAgICAgIGVuZAogICAgICAgICAgcHJvZ3Jlc3MuY2xvc2UgaWYgcHJvZ3Jlc3MudmlzaWJsZT8KICAgICAgICAgIFVJLm1lc3NhZ2Vib3goIuKaoCDYrdiv2Ksg2K7Yt9ijINij2KvZhtin2KEg2KrYrdmF2YrZhCDYp9mE2LnZhti12LE6ICN7ZS5tZXNzYWdlfSIpCiAgICAgICAgICBibG9jay5jYWxsKG5pbCkgaWYgYmxvY2sKICAgICAgICBlbmQKICAgICAgZW5kCgogICAgcmVzY3VlID0+IGUKICAgICAgVUkubWVzc2FnZWJveCgi4pqgINit2K/YqyDYrti32KM6ICN7ZS5tZXNzYWdlfSIpCiAgICAgIGJsb2NrLmNhbGwobmlsKSBpZiBibG9jawogICAgZW5kCiAgZW5kCgogICMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSDYqtit2YXZitmEINin2YTYpdi22KfZgdin2Kog2KfZhNmB2LHYudmK2KkgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIGRlZiBzZWxmLnNhZmVfbG9hZF9sb2NhbChmaWxlX25hbWUpCiAgICByZXR1cm4gZmFsc2UgdW5sZXNzIFBMVUdJTl9ESVIgJiYgRmlsZS5kaXJlY3Rvcnk/KFBMVUdJTl9ESVIpCiAgICBwYXRoID0gRmlsZS5qb2luKFBMVUdJTl9ESVIsIGZpbGVfbmFtZSkKICAgIHJldHVybiBmYWxzZSB1bmxlc3MgRmlsZS5leGlzdD8ocGF0aCkKICAgIGJlZ2luCiAgICAgIGxvYWQgcGF0aAogICAgICB0cnVlCiAgICByZXNjdWUgPT4gZQogICAgICBVSS5tZXNzYWdlYm94KCLimqAg2K7Yt9ijINmB2Yog2KrYrdmF2YrZhCAje2ZpbGVfbmFtZX06XG4je2UubWVzc2FnZX0iKQogICAgICBmYWxzZQogICAgZW5kCiAgZW5kCgogIGRlZiBzZWxmLmNhbGxfaW52b2ljZV9wbHVnaW4KICAgIHVubGVzcyBzYWZlX2xvYWRfbG9jYWwoImludm9pY2UucmIiKQogICAgICBVSS5tZXNzYWdlYm94KCLinYwg2YXZhNmBIGludm9pY2UucmIg2LrZitixINmF2YjYrNmI2K8g2KPZiCDYqNmHINiu2LfYoy4iKQogICAgICByZXR1cm4KICAgIGVuZAogICAgaWYgZGVmaW5lZD8oTUhEZXNpZ24pICYmIE1IRGVzaWduLmNvbnN0X2RlZmluZWQ/KDpNSEludm9pY2UpCiAgICAgIG1vZCA9IE1IRGVzaWduLmNvbnN0X2dldCg6TUhJbnZvaWNlKQogICAgICBpZiBtb2QucmVzcG9uZF90bz8oOm9wZW5faW52b2ljZV9kaWFsb2cpCiAgICAgICAgbW9kLm9wZW5faW52b2ljZV9kaWFsb2cKICAgICAgZWxzZQogICAgICAgIFVJLm1lc3NhZ2Vib3goIuKdjCBpbnZvaWNlLnJiINmE2Kcg2YrYrdiq2YjZiiDYudmE2Ykgb3Blbl9pbnZvaWNlX2RpYWxvZyDZgdmKIE1IRGVzaWduOjpNSEludm9pY2UuIikKICAgICAgZW5kCiAgICBlbHNlCiAgICAgIFVJLm1lc3NhZ2Vib3goIuKdjCBpbnZvaWNlLnJiINmE2Kcg2YrYrdiq2YjZiiDYudmE2YkgTUhEZXNpZ246Ok1ISW52b2ljZS4iKQogICAgZW5kCiAgZW5kCgogIGRlZiBzZWxmLmNhbGxfcmVwb3J0c19wbHVnaW4KICAgIHVubGVzcyBzYWZlX2xvYWRfbG9jYWwoInJlcG9ydF91bml0cy5yYiIpCiAgICAgIFVJLm1lc3NhZ2Vib3goIuKdjCDZhdmE2YEgcmVwb3J0X3VuaXRzLnJiINi62YrYsSDZhdmI2KzZiNivINij2Ygg2KjZhyDYrti32KMuIikKICAgICAgcmV0dXJuCiAgICBlbmQKICAgIGlmIGRlZmluZWQ/KE1IREVTSUdOKSAmJiBNSERFU0lHTi5jb25zdF9kZWZpbmVkPyg6UmVwb3J0VW5pdHMpCiAgICAgIG1vZCA9IE1IREVTSUdOLmNvbnN0X2dldCg6UmVwb3J0VW5pdHMpCiAgICAgIFs6cnVuLCA6c3RhcnQsIDpvcGVuX2RpYWxvZywgOnNob3dfZGlhbG9nLCA6b3BlbiwgOnNob3csIDptYWluLCA6Z2VuZXJhdGVdLmVhY2ggZG8gfG18CiAgICAgICAgYmVnaW4KICAgICAgICAgIGlmIG1vZC5yZXNwb25kX3RvPyhtKQogICAgICAgICAgICBtb2Quc2VuZChtKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgIGVuZAogICAgICAgIHJlc2N1ZQogICAgICAgIGVuZAogICAgICBlbmQKICAgICAgbGlzdCA9IChtb2QubWV0aG9kcyhmYWxzZSkubWFwKCY6dG9fcykuc29ydCByZXNjdWUgW10pCiAgICAgIFVJLm1lc3NhZ2Vib3goIuKdjCByZXBvcnRfdW5pdHMucmIg2YTYpyDZitit2KrZiNmKINi52YTZiSDYp9mE2YjYuNin2KbZgSDYp9mE2YXYqtmI2YLYudipLlxu2KfZhNmI2LjYp9im2YEg2KfZhNmF2YjYrNmI2K/YqSDZgdmKIE1IREVTSUdOOjpSZXBvcnRVbml0czpcbi0gIiArIGxpc3QuZmlyc3QoNDApLmpvaW4oIlxuLSAiKSkKICAgIGVsc2UKICAgICAgVUkubWVzc2FnZWJveCgi4p2MIHJlcG9ydF91bml0cy5yYiDZhNinINmK2K3YqtmI2Yog2LnZhNmJIE1IREVTSUdOOjpSZXBvcnRVbml0cy4iKQogICAgZW5kCiAgZW5kCgogICMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSDYrNi52YQg2KfZhNi52YbYp9i12LEg2YHYsdmK2K/YqSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgbW9kdWxlIE1IREVTSUdOX1VOSVFVSUZZCiAgICBkZWYgc2VsZi5tYWtlX2FsbF9jb21wb25lbnRzX3VuaXF1ZShlbnRpdGllcykKICAgICAgZW50aXRpZXMuZ3JlcChTa2V0Y2h1cDo6Q29tcG9uZW50SW5zdGFuY2UpLmVhY2ggZG8gfGluc3RhbmNlfAogICAgICAgIGluc3RhbmNlLm1ha2VfdW5pcXVlCiAgICAgICAgbWFrZV9hbGxfY29tcG9uZW50c191bmlxdWUoaW5zdGFuY2UuZGVmaW5pdGlvbi5lbnRpdGllcykKICAgICAgZW5kCiAgICBlbmQKICAgIGRlZiBzZWxmLm1ha2VfZGVmaW5pdGlvbnNfdW5pcXVlCiAgICAgIG1vZGVsID0gU2tldGNodXAuYWN0aXZlX21vZGVsCiAgICAgIG1vZGVsLmRlZmluaXRpb25zLmVhY2ggZG8gfGRlZmluaXRpb258CiAgICAgICAgbmV4dCBpZiBkZWZpbml0aW9uLmdyb3VwPyB8fCBkZWZpbml0aW9uLmltYWdlPwogICAgICAgIGRlZmluaXRpb24uaW5zdGFuY2VzLmVhY2ggZG8gfGluc3RhbmNlfAogICAgICAgICAgaW5zdGFuY2UubWFrZV91bmlxdWUKICAgICAgICAgIG1ha2VfYWxsX2NvbXBvbmVudHNfdW5pcXVlKGluc3RhbmNlLmRlZmluaXRpb24uZW50aXRpZXMpCiAgICAgICAgZW5kCiAgICAgIGVuZAogICAgZW5kCiAgICBkZWYgc2VsZi5ydW5fdW5pcXVpZnkKICAgICAgbW9kZWwgPSBTa2V0Y2h1cC5hY3RpdmVfbW9kZWwKICAgICAgbW9kZWwuc3RhcnRfb3BlcmF0aW9uKCLYrNi52YQg2KzZhdmK2Lkg2KfZhNi52YbYp9i12LEg2YHYsdmK2K/YqSIsIHRydWUpCiAgICAgIG1ha2VfYWxsX2NvbXBvbmVudHNfdW5pcXVlKG1vZGVsLmVudGl0aWVzKQogICAgICBtYWtlX2RlZmluaXRpb25zX3VuaXF1ZQogICAgICBtb2RlbC5jb21taXRfb3BlcmF0aW9uCiAgICAgIFVJLm1lc3NhZ2Vib3goIuKchSDYqtmFINis2LnZhCDYrNmF2YrYuSDYp9mE2LnZhtin2LXYsSDZgdix2YrYr9ipLiIpCiAgICBlbmQKICBlbmQKCiAgIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09INil2LjZh9in2LEg2KfZhNmF2YPYqtio2KkgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIGRlZiBzZWxmLnNob3dfbGlicmFyeQogICAgIyDYp9mE2KrYrdmC2YIg2KfZhNiq2YTZgtin2KbZiiDYo9mI2YTYp9mLCiAgICB1bmxlc3MgU2tldGNodXAucmVhZF9kZWZhdWx0KFBMVUdJTl9OQU1FLCAiYWN0aXZhdGVkX29uY2UiKQogICAgICB1bmxlc3MgYXV0b19hY3RpdmF0ZQogICAgICAgIGFjdGl2YXRlKHRydWUpCiAgICAgICAgcmV0dXJuIHVubGVzcyBTa2V0Y2h1cC5yZWFkX2RlZmF1bHQoUExVR0lOX05BTUUsICJhY3RpdmF0ZWRfb25jZSIpCiAgICAgIGVuZAogICAgZW5kCgogICAgIyDZh9mG2Kcg2YrYqNmC2Ykg2YPZiNivINmI2KfYrNmH2Kkg2KfZhNmF2YPYqtio2Kkg2YPZhdinINmH2Ygg2KjYr9mI2YYg2KrYutmK2YrYsQogICAgIyAuLi4gKNmG2YHYsyDYp9mE2YPZiNivINin2YTYs9in2KjZgikKICBlbmQKCiAgIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09INiq2YfZitim2Kkg2KfZhNmC2KfYptmF2KkgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIHVubGVzcyBmaWxlX2xvYWRlZD8oX19GSUxFX18pCiAgICAjINin2YTYqtit2YLZgiDYp9mE2KrZhNmC2KfYptmKINi52YbYryDYqti02LrZitmEINin2YTYpdi22KfZgdipCiAgICBVSS5zdGFydF90aW1lcigxLjAsIGZhbHNlKSBkbwogICAgICBhdXRvX2FjdGl2YXRlCiAgICBlbmQKICAgIAogICAgbWVudSA9IFVJLm1lbnUoIlBsdWdpbnMiKS5hZGRfc3VibWVudSgiTUhERVNJR04iKQogICAgCiAgICBtZW51LmFkZF9pdGVtKCLYqtmB2LnZitmEIikgZG8KICAgICAgTUhERVNJR04uYWN0aXZhdGUodHJ1ZSkKICAgIGVuZAogICAgCiAgICBtZW51LmFkZF9pdGVtKCLZhdi52YTZiNmF2KfYqiDYp9mE2YXYs9iq2K7Yr9mFIikgZG8KICAgICAgTUhERVNJR04uc2hvd191c2VyX2luZm8KICAgIGVuZAogICAgCiAgICBtZW51LmFkZF9zZXBhcmF0b3IKICAgIAogICAgbWVudS5hZGRfaXRlbSgi2YXZg9iq2KjYqSDYp9mE2LnZhtin2LXYsSIpIGRvCiAgICAgIE1IREVTSUdOLnNob3dfbGlicmFyeQogICAgZW5kCiAgICAKICAgIG1lbnUuYWRkX2l0ZW0oItil2YbYtNin2KEg2YHYp9iq2YjYsdipIikgZG8KICAgICAgTUhERVNJR04uY2FsbF9pbnZvaWNlX3BsdWdpbgogICAgZW5kCiAgICAKICAgIG1lbnUuYWRkX2l0ZW0oItiq2YLYsdmK2LEg2KfZhNmI2K3Yr9in2KoiKSBkbwogICAgICBNSERFU0lHTi5jYWxsX3JlcG9ydHNfcGx1Z2luCiAgICBlbmQKICAgIAogICAgbWVudS5hZGRfaXRlbSgi2KzYudmEINin2YTYudmG2KfYtdixINmB2LHZitiv2KkiKSBkbwogICAgICBNSERFU0lHTjo6TUhERVNJR05fVU5JUVVJRlkucnVuX3VuaXF1aWZ5CiAgICBlbmQKICAgIAogICAgbWVudS5hZGRfc2VwYXJhdG9yCiAgICAKICAgIG1lbnUuYWRkX2l0ZW0oItmF2LPYrSDYp9mE2KrYrtiy2YrZhiDYp9mE2YXYpNmC2KoiKSBkbwogICAgICBNSERFU0lHTi5jbGVhcl9jYWNoZQogICAgZW5kCiAgICAKICAgIGZpbGVfbG9hZGVkKF9fRklMRV9fKQogIGVuZAplbmQ="  // كود روبي مشفر بـ base64
}
